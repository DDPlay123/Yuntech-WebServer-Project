<!DOCTYPE html>
<html style="font-size: 16px;">
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="utf-8">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="page_type" content="np-template-header-footer-from-plugin">
    <title>Map</title>
    <link rel="stylesheet" href="/css/nicepage.css" media="screen">
	<link rel="stylesheet" href="/css/Map.css" media="screen">
    <script class="u-script" type="text/javascript" src="/js/jquery.js" defer=""></script>
    <script class="u-script" type="text/javascript" src="/js/nicepage.js" defer=""></script>
    <meta name="generator" content="Nicepage 4.0.3, nicepage.com">
	<link rel="icon" href="favicon.ico">
    <link id="u-theme-google-font" rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,100i,300,300i,400,400i,500,500i,700,700i,900,900i|Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i">
    <style>
			#map {
			height: 85%;
			}
			html, body {
			height: 100%;
			margin: 0;
			padding: 0;
			}
	</style>
    <script type="application/ld+json">{
		"@context": "http://schema.org",
		"@type": "Organization",
		"name": ""
		}
	</script>
    <meta name="theme-color" content="#478ac9">
    <meta property="og:title" content="Map">
    <meta property="og:type" content="website">
  </head>
  <body class="u-body"><header class=" u-clearfix u-header u-section-row-container" id="sec-8d75"><div class="u-section-rows">
        <div class="u-clearfix u-custom-color-1 u-hidden-xs u-section-row u-section-row-1" data-animation-name="" data-animation-duration="0" data-animation-delay="0" data-animation-direction="" id="sec-c20e">
          <div class="u-clearfix u-sheet u-valign-middle u-sheet-1">
            <h3 class="u-headline u-text u-text-1">
              <a href="/"><img class="infoIMG" src="/favicontext.png"width="500" height="100"></a>
            </h3>
          </div>
        </div>
        <div class="u-custom-color-2 u-section-row u-section-row-2" id="sec-8184">
          <div class="u-clearfix u-sheet u-sheet-2">
            <nav class="u-align-center u-menu u-menu-one-level u-menu-open-right u-offcanvas u-menu-1" data-responsive-from="MD">
              <div class="menu-collapse" style="font-size: 1.5rem; font-weight: 400;">
                <a class="u-button-style u-custom-active-color u-custom-border-radius u-custom-color u-custom-hover-color u-custom-left-right-menu-spacing u-custom-text-active-color u-custom-text-hover-color u-custom-text-shadow u-nav-link" href="#" style="padding: 4px 10px; font-size: calc(1em + 8px);">
                  <svg class="u-svg-link" preserveAspectRatio="xMidYMin slice" viewBox="0 0 302 302" style=""><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#svg-bc4f"></use></svg>
                  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="svg-bc4f" x="0px" y="0px" viewBox="0 0 302 302" style="enable-background:new 0 0 302 302;" xml:space="preserve" class="u-svg-content"><g><rect y="36" width="302" height="30"></rect><rect y="236" width="302" height="30"></rect><rect y="136" width="302" height="30"></rect>
				</g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g><g></g></svg>
                </a>
              </div>
              <div class="u-custom-menu u-nav-container">
                <ul class="u-nav u-spacing-0 u-unstyled u-nav-1"><li class="u-nav-item"><a class="u-active-custom-color-4 u-button-style u-custom-color-2 u-hover-custom-color-4 u-nav-link u-text-active-white u-text-hover-custom-color-3" href="/" style="padding: 8px 102px;">Home</a></li>
					<li class="u-nav-item"><a class="u-active-custom-color-4 u-button-style u-custom-color-2 u-hover-custom-color-4 u-nav-link u-text-active-white u-text-hover-custom-color-3" href="/web/list" style="padding: 8px 102px;">List</a></li>
					<li class="u-nav-item"><a class="u-active-custom-color-4 u-button-style u-custom-color-2 u-hover-custom-color-4 u-nav-link u-text-active-white u-text-hover-custom-color-3" href="/web/map" style="padding: 8px 96px 8px 102px;">Map</a></li>
				</ul>
              </div>
              <div class="u-custom-menu u-nav-container-collapse">
                <div class="u-align-center u-black u-container-style u-inner-container-layout u-opacity u-opacity-95 u-sidenav u-sidenav-1" data-offcanvas-width="150">
                  <div class="u-inner-container-layout u-sidenav-overflow">
                    <div class="u-menu-close"></div>
                    <ul class="u-align-center u-nav u-popupmenu-items u-unstyled u-nav-2"><li class="u-nav-item"><a class="u-button-style u-nav-link" href="/" style="padding: 18px 82px;">Home</a></li>
						<li class="u-nav-item"><a class="u-button-style u-nav-link" href="/web/list" style="padding: 18px 82px;">List</a></li>
						<li class="u-nav-item"><a class="u-button-style u-nav-link" href="/web/map" style="padding: 18px 82px;">Map</a></li>
					</ul>
                  </div>
                </div>
                <div class="u-black u-menu-overlay u-opacity u-opacity-70"></div>
              </div>
            </nav>
          </div>  
        </div>
      </div></header>
	  <div id="map"></div>
	<script>
		var map;
		var markers = [];
		var temp = [];
		var infoWindows = [];
		<% if (data) { %>
			let j = 0;
			<% data.forEach(function(user){ %>
				var position = {lat:<%= user.latitude %>, lng:<%= user.longitude %>, breed:String('<%= user.name %>') , time:String('<%= user.date.toLocaleString("zh-TW",{hour12:false}) %>'), img:String('<%= user.photo %>')};
				temp[j]= position
				j = j + 1;
				console.log(position);	
			<% }) %>
		<% } %>
		console.log(temp);
		function initMap() {
			map = new google.maps.Map(document.getElementById('map'), {
				zoom: 16,
				center: {
				lat: 23.692544,
				lng: 120.534734
				}
			});
			
			for (var i = 0; i < temp.length; i++) {
				infoconfig(i);
				addMarker(i);
			}
		}
		
		function infoconfig(k) {
			var content='<h3>品種:'+temp[k].breed+'</h3>'
						+'<h3>拍攝時間:'+temp[k].time+'</h3>'
						+'<img class="infoIMG" src="/upload/'+temp[k].img+'"width="200" height="200">'
			for(var x = 0; x < temp.length; x++){
				if(temp[x].lat == temp[k].lat && temp[x].lng == temp[k].lng && temp[x].time != temp[k].time){
					content = content	+'<h3>品種：　'+temp[x].breed+'</h3>'
										+'<h3>拍攝時間:'+temp[x].time+'</h3>'
										+'<img class="infoIMG" src="/upload/'+temp[x].img+'"width="200" height="200">'
				}
			}
			infoWindows[k] = new google.maps.InfoWindow({
					content: content
			});
		}	
		function addMarker(e) {
			markers[e] = new google.maps.Marker({
			position: {
				lat: parseFloat(temp[e].lat),
				lng: parseFloat(temp[e].lng)
			},
			map: map
			});
			markers[e].addListener('click', function() {infoWindows[e].open(map, markers[e]);});
		}
	</script>
	<script src="https://maps.googleapis.com/maps/api/js?key=Google Map Key=initMap"async defer></script>   
    <footer class="u-align-center u-clearfix u-footer u-grey-80 u-footer" id="sec-ed5b"><div class="u-clearfix u-sheet u-sheet-1">
        <p class="u-small-text u-text u-text-variant u-text-1">製作者：麥光廷、劉佳瑋</p>
      </div>
	</footer>
  </body>
</html>